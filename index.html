<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#E07A5F">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Wellness Journal">
  <meta name="description" content="Track your daily health, workouts, and wellness activities">
  
  <title>Wellness Journal</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIldlbGxuZXNzIEpvdXJuYWwiLAogICJzaG9ydF9uYW1lIjogIldlbGxuZXNzIiwKICAiZGVzY3JpcHRpb24iOiAiVHJhY2sgeW91ciBkYWlseSBoZWFsdGggYW5kIHdlbGxuZXNzIGFjdGl2aXRpZXMiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI0ZERjhGNCIsCiAgInRoZW1lX2NvbG9yIjogIiNFMDdBNUYiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyByeD0nMjAnIGZpbGw9JyUyM0UwN0E1RiclM0UlM0MvcmVjdCUzRSUzQ3RleHQgeD0nNTAnIHk9JzY1JyBmb250LXNpemU9JzUwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmaWxsPSd3aGl0ZSclM0Xwn5SlJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0KfQ==">
  
  <!-- iOS Icons -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23E07A5F'%3E%3C/rect%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white'%3Eüî•%3C/text%3E%3C/svg%3E">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Source+Sans+3:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Source Sans 3', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #FDF8F4 0%, #F5EDE8 50%, #FDF0ED 100%);
      min-height: 100vh;
      min-height: -webkit-fill-available;
      overscroll-behavior: none;
    }
    
    html {
      height: -webkit-fill-available;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      padding-top: max(20px, env(safe-area-inset-top));
      padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: linear-gradient(135deg, #FDF0ED 0%, #FFEEE8 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(224, 122, 95, 0.2);
      font-size: 24px;
    }
    
    .title {
      font-family: 'Fraunces', serif;
      font-size: 26px;
      font-weight: 700;
      color: #3D3229;
      letter-spacing: -0.5px;
    }
    
    .subtitle {
      font-size: 14px;
      color: #8B7E74;
    }
    
    .view-toggle {
      display: flex;
      gap: 8px;
      background: #fff;
      padding: 6px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    
    .toggle-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: transparent;
      color: #8B7E74;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }
    
    .toggle-btn.active {
      background: linear-gradient(135deg, #E07A5F 0%, #D4694E 100%);
      color: #fff;
      box-shadow: 0 2px 8px rgba(224, 122, 95, 0.3);
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      background: #fff;
      padding: 16px 20px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    
    .nav-btn {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 1px solid #E8E2DD;
      background: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #5D5348;
      font-size: 20px;
      transition: all 0.2s;
    }
    
    .nav-btn:active {
      transform: scale(0.95);
      background: #F5EDE8;
    }
    
    .month-title {
      font-family: 'Fraunces', serif;
      font-size: 20px;
      font-weight: 600;
      color: #3D3229;
    }
    
    .week-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 8px;
    }
    
    .week-day {
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: #8B7E74;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 8px 0;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 20px;
    }
    
    .day-cell {
      aspect-ratio: 1;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: all 0.2s ease;
      animation: fadeInUp 0.4s ease forwards;
      opacity: 0;
    }
    
    .day-cell.active {
      background: #fff;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .day-cell.active:active {
      transform: scale(0.95);
    }
    
    .day-cell.today {
      background: linear-gradient(135deg, #E07A5F 0%, #D4694E 100%);
      box-shadow: 0 4px 16px rgba(224, 122, 95, 0.3);
    }
    
    .day-number {
      font-size: 15px;
      font-weight: 500;
      color: #3D3229;
    }
    
    .day-cell.today .day-number {
      color: #fff;
      font-weight: 600;
    }
    
    .category-dots {
      display: flex;
      gap: 3px;
    }
    
    .category-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    
    .legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      padding: 14px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .legend-text {
      font-size: 12px;
      color: #5D5348;
    }
    
    /* Stats View */
    .stats-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .streak-card {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      background: linear-gradient(135deg, #fff 0%, #FDF8F4 100%);
      padding: 28px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    }
    
    .streak-icon {
      font-size: 32px;
    }
    
    .streak-number {
      font-family: 'Fraunces', serif;
      font-size: 48px;
      font-weight: 700;
      color: #E07A5F;
      line-height: 1;
    }
    
    .streak-label {
      font-size: 16px;
      color: #8B7E74;
      font-weight: 500;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .stat-card {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    
    .stat-number {
      font-family: 'Fraunces', serif;
      font-size: 28px;
      font-weight: 600;
      color: #3D3229;
    }
    
    .stat-label {
      font-size: 13px;
      color: #8B7E74;
    }
    
    .chart-section {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    
    .chart-title {
      font-family: 'Fraunces', serif;
      font-size: 16px;
      font-weight: 600;
      color: #3D3229;
      margin-bottom: 14px;
    }
    
    .chart {
      display: flex;
      align-items: flex-end;
      gap: 3px;
      height: 80px;
    }
    
    .chart-bar {
      flex: 1;
      height: 100%;
      background: #F5EDE8;
      border-radius: 3px;
      display: flex;
      align-items: flex-end;
    }
    
    .chart-bar-fill {
      width: 100%;
      background: linear-gradient(180deg, #E07A5F 0%, #D4694E 100%);
      border-radius: 3px;
      min-height: 3px;
      animation: growUp 0.6s ease forwards;
    }
    
    .category-stats {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }
    
    .category-stat-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid #F5EDE8;
    }
    
    .category-stat-row:last-child {
      border-bottom: none;
    }
    
    .category-stat-icon {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .category-stat-name {
      font-size: 14px;
      font-weight: 500;
      color: #3D3229;
      min-width: 70px;
    }
    
    .category-stat-bar {
      flex: 1;
      height: 8px;
      background: #F5EDE8;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .category-stat-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.6s ease;
    }
    
    .category-stat-count {
      font-size: 14px;
      font-weight: 600;
      color: #5D5348;
      min-width: 28px;
      text-align: right;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(61, 50, 41, 0.4);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
      animation: fadeIn 0.2s ease;
    }
    
    .modal {
      background: #fff;
      border-radius: 24px 24px 24px 24px;
      width: 100%;
      max-width: 440px;
      max-height: 80vh;
      overflow: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      animation: slideUp 0.3s ease;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 20px;
      border-bottom: 1px solid #F5EDE8;
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 1;
    }
    
    .modal-title {
      font-family: 'Fraunces', serif;
      font-size: 17px;
      font-weight: 600;
      color: #3D3229;
    }
    
    .close-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: #F5EDE8;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #5D5348;
      font-size: 18px;
    }
    
    .modal-body {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .existing-entries {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .entry-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 10px;
    }
    
    .entry-icon {
      font-size: 16px;
    }
    
    .entry-text {
      flex: 1;
      font-size: 14px;
      color: #3D3229;
    }
    
    .delete-btn {
      width: 26px;
      height: 26px;
      border-radius: 6px;
      border: none;
      background: rgba(0,0,0,0.05);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8B7E74;
      font-size: 14px;
    }
    
    .category-select {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .category-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 14px 14px;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
      font-weight: 500;
      background: transparent;
      font-family: inherit;
    }
    
    .category-btn.selected {
      border-width: 2px;
    }
    
    .category-btn:active {
      transform: scale(0.97);
    }
    
    .input {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 2px solid #E8E2DD;
      font-size: 15px;
      outline: none;
      transition: border-color 0.2s;
      font-family: inherit;
    }
    
    .input:focus {
      border-color: #E07A5F;
    }
    
    .add-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #E07A5F 0%, #D4694E 100%);
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(224, 122, 95, 0.3);
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: inherit;
    }
    
    .add-btn:active {
      transform: scale(0.97);
    }
    
    .hidden {
      display: none !important;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }
    
    @keyframes growUp {
      from { height: 0; }
    }
    
    /* Install prompt */
    .install-prompt {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      background: #fff;
      border-radius: 16px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 999;
      animation: slideUp 0.3s ease;
    }
    
    .install-prompt-text {
      flex: 1;
    }
    
    .install-prompt-title {
      font-weight: 600;
      color: #3D3229;
      margin-bottom: 2px;
    }
    
    .install-prompt-subtitle {
      font-size: 13px;
      color: #8B7E74;
    }
    
    .install-btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      background: #E07A5F;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
    }
    
    .install-close {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: none;
      background: #F5EDE8;
      cursor: pointer;
      font-size: 16px;
      color: #8B7E74;
    }
  </style>
</head>
<body>
  <div class="container" id="app"></div>

  <script>
    // Categories
    const CATEGORIES = [
      { id: 'workout', name: 'Workout', icon: 'üí™', color: '#E07A5F', bgColor: '#FDF0ED' },
      { id: 'water', name: 'Water', icon: 'üíß', color: '#3D85C6', bgColor: '#EDF4FA' },
      { id: 'sleep', name: 'Sleep', icon: 'üåô', color: '#6B5B95', bgColor: '#F3F1F8' },
      { id: 'nutrition', name: 'Nutrition', icon: 'üçé', color: '#81B29A', bgColor: '#EFF6F2' },
      { id: 'mood', name: 'Mood', icon: '‚ù§Ô∏è', color: '#F2CC8F', bgColor: '#FDFAF3' },
    ];

    const DAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    // State
    let currentDate = new Date();
    let selectedDate = null;
    let entries = {};
    let view = 'calendar';
    let newEntryCategory = 'workout';

    // Load/Save
    function loadEntries() {
      const saved = localStorage.getItem('wellness-entries');
      if (saved) entries = JSON.parse(saved);
    }

    function saveEntries() {
      localStorage.setItem('wellness-entries', JSON.stringify(entries));
    }

    // Helpers
    function formatDateKey(year, month, day) {
      return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    }

    function getDaysInMonth(date) {
      const year = date.getFullYear();
      const month = date.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDay = firstDay.getDay();
      
      const days = [];
      for (let i = 0; i < startingDay; i++) days.push(null);
      for (let i = 1; i <= daysInMonth; i++) days.push(i);
      return days;
    }

    function isToday(day) {
      const today = new Date();
      return day === today.getDate() && 
        currentDate.getMonth() === today.getMonth() && 
        currentDate.getFullYear() === today.getFullYear();
    }

    function getEntriesForDay(day) {
      if (!day) return [];
      const dateKey = formatDateKey(currentDate.getFullYear(), currentDate.getMonth(), day);
      return entries[dateKey] || [];
    }

    function getStats() {
      const allEntries = Object.values(entries).flat();
      const categoryCount = {};
      CATEGORIES.forEach(cat => categoryCount[cat.id] = 0);
      allEntries.forEach(entry => {
        if (categoryCount[entry.category] !== undefined) {
          categoryCount[entry.category]++;
        }
      });
      
      const last30Days = [];
      const today = new Date();
      for (let i = 29; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(d.getDate() - i);
        const key = formatDateKey(d.getFullYear(), d.getMonth(), d.getDate());
        last30Days.push({ date: d, count: (entries[key] || []).length });
      }
      
      let currentStreak = 0;
      const d = new Date();
      while (true) {
        const key = formatDateKey(d.getFullYear(), d.getMonth(), d.getDate());
        if (entries[key] && entries[key].length > 0) {
          currentStreak++;
          d.setDate(d.getDate() - 1);
        } else break;
      }
      
      return { categoryCount, last30Days, currentStreak, totalEntries: allEntries.length };
    }

    // Render
    function render() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <header class="header">
          <div class="logo-section">
            <div class="logo-icon">üî•</div>
            <div>
              <h1 class="title">Wellness Journal</h1>
              <p class="subtitle">Track your daily progress</p>
            </div>
          </div>
          
          <div class="view-toggle">
            <button class="toggle-btn ${view === 'calendar' ? 'active' : ''}" onclick="setView('calendar')">
              üìÖ Calendar
            </button>
            <button class="toggle-btn ${view === 'stats' ? 'active' : ''}" onclick="setView('stats')">
              üìä Progress
            </button>
          </div>
        </header>

        ${view === 'calendar' ? renderCalendar() : renderStats()}
      `;
    }

    function renderCalendar() {
      const days = getDaysInMonth(currentDate);
      
      return `
        <div class="calendar-header">
          <button class="nav-btn" onclick="prevMonth()">‚Äπ</button>
          <h2 class="month-title">${MONTHS[currentDate.getMonth()]} ${currentDate.getFullYear()}</h2>
          <button class="nav-btn" onclick="nextMonth()">‚Ä∫</button>
        </div>

        <div class="week-days">
          ${DAYS.map(d => `<div class="week-day">${d}</div>`).join('')}
        </div>

        <div class="calendar-grid">
          ${days.map((day, i) => {
            const dayEntries = getEntriesForDay(day);
            const categories = [...new Set(dayEntries.map(e => e.category))];
            return `
              <div class="day-cell ${day ? 'active' : ''} ${isToday(day) ? 'today' : ''}" 
                   style="animation-delay: ${i * 15}ms"
                   ${day ? `onclick="openModal(${day})"` : ''}>
                ${day ? `
                  <span class="day-number">${day}</span>
                  ${categories.length > 0 ? `
                    <div class="category-dots">
                      ${categories.slice(0, 4).map(catId => {
                        const cat = CATEGORIES.find(c => c.id === catId);
                        return `<div class="category-dot" style="background-color: ${cat?.color || '#ccc'}"></div>`;
                      }).join('')}
                    </div>
                  ` : ''}
                ` : ''}
              </div>
            `;
          }).join('')}
        </div>

        <div class="legend">
          ${CATEGORIES.map(cat => `
            <div class="legend-item">
              <div class="legend-dot" style="background-color: ${cat.color}"></div>
              <span class="legend-text">${cat.name}</span>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderStats() {
      const stats = getStats();
      const maxCount = Math.max(...Object.values(stats.categoryCount), 1);
      
      return `
        <div class="stats-container">
          <div class="streak-card">
            <span class="streak-icon">üî•</span>
            <div>
              <div class="streak-number">${stats.currentStreak}</div>
              <div class="streak-label">day streak</div>
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <span class="stat-number">${stats.totalEntries}</span>
              <span class="stat-label">Total Entries</span>
            </div>
            <div class="stat-card">
              <span class="stat-number">${Object.keys(entries).length}</span>
              <span class="stat-label">Active Days</span>
            </div>
          </div>

          <div class="chart-section">
            <h3 class="chart-title">Last 30 Days Activity</h3>
            <div class="chart">
              ${stats.last30Days.map((day, i) => `
                <div class="chart-bar" title="${day.date.toLocaleDateString()}: ${day.count} entries">
                  <div class="chart-bar-fill" style="height: ${Math.min(day.count * 20, 100)}%; animation-delay: ${i * 30}ms"></div>
                </div>
              `).join('')}
            </div>
          </div>

          <div class="category-stats">
            <h3 class="chart-title">By Category</h3>
            ${CATEGORIES.map(cat => {
              const count = stats.categoryCount[cat.id];
              return `
                <div class="category-stat-row">
                  <div class="category-stat-icon" style="background-color: ${cat.bgColor}">
                    ${cat.icon}
                  </div>
                  <span class="category-stat-name">${cat.name}</span>
                  <div class="category-stat-bar">
                    <div class="category-stat-bar-fill" style="width: ${(count / maxCount) * 100}%; background-color: ${cat.color}"></div>
                  </div>
                  <span class="category-stat-count">${count}</span>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    function renderModal() {
      const dayEntries = getEntriesForDay(selectedDate);
      const dateKey = formatDateKey(currentDate.getFullYear(), currentDate.getMonth(), selectedDate);
      
      return `
        <div class="modal-overlay" onclick="closeModal()">
          <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
              <h3 class="modal-title">Add Entry - ${MONTHS[currentDate.getMonth()]} ${selectedDate}</h3>
              <button class="close-btn" onclick="closeModal()">‚úï</button>
            </div>

            <div class="modal-body">
              ${dayEntries.length > 0 ? `
                <div class="existing-entries">
                  ${dayEntries.map(entry => {
                    const cat = CATEGORIES.find(c => c.id === entry.category);
                    return `
                      <div class="entry-item" style="background-color: ${cat?.bgColor}">
                        <span class="entry-icon">${cat?.icon}</span>
                        <span class="entry-text">${entry.note || entry.value}</span>
                        <button class="delete-btn" onclick="deleteEntry('${dateKey}', ${entry.id})">‚úï</button>
                      </div>
                    `;
                  }).join('')}
                </div>
              ` : ''}

              <div class="category-select">
                ${CATEGORIES.map(cat => `
                  <button class="category-btn ${newEntryCategory === cat.id ? 'selected' : ''}" 
                          style="background-color: ${newEntryCategory === cat.id ? cat.bgColor : 'transparent'}; border-color: ${newEntryCategory === cat.id ? cat.color : '#e0e0e0'}; color: ${cat.color}"
                          onclick="selectCategory('${cat.id}')">
                    ${cat.icon} ${cat.name}
                  </button>
                `).join('')}
              </div>

              <input type="text" id="entry-input" class="input" placeholder="What did you do? (e.g., 30 min run)">

              <button class="add-btn" onclick="addEntry()">‚úì Add Entry</button>
            </div>
          </div>
        </div>
      `;
    }

    // Actions
    function setView(v) {
      view = v;
      render();
    }

    function prevMonth() {
      currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
      render();
    }

    function nextMonth() {
      currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
      render();
    }

    function openModal(day) {
      selectedDate = day;
      newEntryCategory = 'workout';
      document.body.insertAdjacentHTML('beforeend', renderModal());
      setTimeout(() => document.getElementById('entry-input')?.focus(), 100);
    }

    function closeModal() {
      document.querySelector('.modal-overlay')?.remove();
      selectedDate = null;
    }

    function selectCategory(catId) {
      newEntryCategory = catId;
      const modal = document.querySelector('.modal');
      if (modal) {
        document.querySelector('.modal-overlay').outerHTML = renderModal();
      }
    }

    function addEntry() {
      const input = document.getElementById('entry-input');
      const note = input?.value?.trim();
      if (!note) return;
      
      const dateKey = formatDateKey(currentDate.getFullYear(), currentDate.getMonth(), selectedDate);
      if (!entries[dateKey]) entries[dateKey] = [];
      entries[dateKey].push({
        id: Date.now(),
        category: newEntryCategory,
        note: note,
        timestamp: new Date().toISOString()
      });
      
      saveEntries();
      closeModal();
      render();
    }

    function deleteEntry(dateKey, entryId) {
      entries[dateKey] = entries[dateKey].filter(e => e.id !== entryId);
      if (entries[dateKey].length === 0) delete entries[dateKey];
      saveEntries();
      document.querySelector('.modal-overlay').outerHTML = renderModal();
      render();
    }

    // PWA Install
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallPrompt();
    });

    function showInstallPrompt() {
      if (localStorage.getItem('pwa-install-dismissed')) return;
      
      const prompt = document.createElement('div');
      prompt.className = 'install-prompt';
      prompt.innerHTML = `
        <span style="font-size: 28px">üì±</span>
        <div class="install-prompt-text">
          <div class="install-prompt-title">Install App</div>
          <div class="install-prompt-subtitle">Add to your home screen</div>
        </div>
        <button class="install-btn" onclick="installPWA()">Install</button>
        <button class="install-close" onclick="dismissInstall()">‚úï</button>
      `;
      document.body.appendChild(prompt);
    }

    function installPWA() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(() => {
          deferredPrompt = null;
          document.querySelector('.install-prompt')?.remove();
        });
      }
    }

    function dismissInstall() {
      localStorage.setItem('pwa-install-dismissed', 'true');
      document.querySelector('.install-prompt')?.remove();
    }

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
        self.addEventListener('install', e => self.skipWaiting());
        self.addEventListener('activate', e => e.waitUntil(clients.claim()));
        self.addEventListener('fetch', e => {
          e.respondWith(fetch(e.request).catch(() => caches.match(e.request)));
        });
      `)).catch(() => {});
    }

    // Init
    loadEntries();
    render();
  </script>
</body>
</html>
